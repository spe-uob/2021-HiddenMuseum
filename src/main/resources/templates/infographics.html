<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Infographics</title>
    <script src="https://use.fontawesome.com/639e5b5645.js"></script>
    <script src="path/to/chartjs/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="path/to/chartjs-plugin-zoom/dist/chartjs-plugin-zoom.min.js"></script>

    <link rel="stylesheet" href="/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>
    <div>
        <canvas id="myChart"></canvas>
    </div>
    <p id="Title"></p>
    <div id="container"></div>
</body>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    const datesToInclude = /*[[${datesToInclude}]]*/[];
    const numOfDates = /*[[${numOfDates}]]*/[];
    const datesOfItems = /*[[${datesOfItems}]]*/[];
    const ListOfTitles = /*[[${ListOfTitles}]]*/[];
    const ids = /*[[${ids}]]*/[];
    const usedDates = /*[[${usedDates}]]*/[];
    const numOfDatesNonZero = /*[[${numOfDatesNonZero}]]*/[];

    const numOFLinksMax = Math.max.apply(Math, numOfDates);
    var container = document.getElementById("container");
    for (i = 0; i < numOFLinksMax; i++) {
        newlink = document.createElement('a');
        newlink.setAttribute('href', '/');
        newlink.name = "link" + i;
        newlink.innerHTML = 'link' + i;
        newlink.setAttribute('class', 'hidden');
        container.appendChild(newlink);
        container.appendChild(document.createElement("br"));
    }

    const data = {
        labels: datesToInclude,
        datasets: [{
            label: 'Artworks by time',
            borderColor: 'rgb(255, 99, 132)',
            data: numOfDates,
            barThickness: 2,
            backgroundColor: [
                'rgb(255, 99, 132)',
                'rgb(54, 162, 235)',
                'rgb(255, 205, 86)'
            ],
        }]
    };

    const config = {
        type: 'bar',
        data: data,
        options: {
            plugins: {
                zoom: {
                    zoom: {
                        wheel: {
                            enabled: true,
                        },
                        pinch: {
                            enabled: true
                        },
                        mode: 'xy',
                    }
                }
            },
            layout: {
                padding: 40,
            },
            onClick: (event, activeElements) => {
                console.log("getElementsAtEventForMode: %o", myChart.getElementsAtEventForMode(event, "nearest", { intersect: false }));
                var whereAt = myChart.getElementsAtEventForMode(event, "point", { intersect: false });
                try {
                    console.log(whereAt[0].index);
                    console.log("===== </CLICK EVENT> =====");
                    document.getElementById("Title").innerHTML = ListOfTitles[datesOfItems.indexOf(whereAt[0].index + datesToInclude[0])]
                    var indexOfIdList = 0;
                    for (var i = 0; i < usedDates.length; i++) {
                        //console.log("hello")
                        //numOfDates.indexOf(whereAt[0].index + datesToInclude[0])
                        //usedDates.length
                        //console.log(numOfDates[0])
                        var num = whereAt[0].index
                        if (usedDates[i] == numOfDates[num]) {
                            console.log("bruh")
                            var z = num
                            for (var j = 0; j < num-1; j++) {
                                //console.log(z)
                                if (numOfDates[num - j] == 0) {
                                    z = z - 1
                                }
                               // console.log(z)
                            }
                            if (z == i) {
                                console.log("bitch")
                                indexOfIdList = i;
                            }

                        }
                    }
                    
                    var totalRecordBefore = 0; //how many records in total before the frist one in this clump
                    var sizeOfNextClump = 0; //how many records are there in the next group
                    for (var i = 0; i < indexOfIdList; i++) {
                        totalRecordBefore = totalRecordBefore + usedDates[i]
                        console.log(totalRecordBefore)
                        sizeOfNextClump = usedDates[i]
                    }
                    console.log("Cheese")
                    var children = container.children;
                    for (var i = 0; i < children.length; i++) {
                        var linkChild = children[i];
                        linkChild.setAttribute('href', '/');
                        linkChild.setAttribute('class', 'hidden');
                        console.log(sizeOfNextClump)
                    }
                    console.log("Cheese")
                    for (var i = 0; i < sizeOfNextClump ; i++) {
                        console.log("Cheese")
                        var linkChild = children[i];
                        linkChild.setAttribute('class', 'shown');
                        console.log(ids[0])
                        linkChild.setAttribute('href', '/item/open-data-gallery-3-european-old-masters/' + ids[i + totalRecordBefore]);
                    }
                    container.get
                } catch (error) {

                }
            }
        }
    };
</script>


<script>
    const myChart = new Chart(
        document.getElementById('myChart'),
        config
    );
</script>