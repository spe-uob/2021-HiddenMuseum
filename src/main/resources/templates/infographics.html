<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Infographics</title>
    <script src="https://use.fontawesome.com/639e5b5645.js"></script>
    <link href="//db.onlinewebfonts.com/c/97294bc26984beb9185137b039854f9b?family=D-DIN" rel="stylesheet" type="text/css"/>
    <link href="//db.onlinewebfonts.com/c/8e59fdbc7a7fdb1bab1b12af14615047?family=ITCAvantGardeGothicW05-Book"
          rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>
<div class="BristolMuseum stay">
    <a href="/">
        <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse1.mm.bing.net%2Fth%3Fid%3DOIP.OCdb4ZnlSV7vmUEh3SXcjwHaFl%26pid%3DApi&f=1"
             alt="Bristol museum logo" height="100">
    </a>
    <button class="dropdown-btn navBut"><a href="/search"> Back to search</a></button>
</div>
<br>
<br>
<br>
<br>
    <div>
        <canvas id="myChart"></canvas>
    </div>
    <p id="Title"></p>
    <div id="container"></div>
</body>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    const datesToInclude = /*[[${datesToInclude}]]*/ [];
    const numOfDates = /*[[${numOfDates}]]*/ [];
    const datesOfItems = /*[[${datesOfItems}]]*/ [];
    const ListOfTitles = /*[[${ListOfTitles}]]*/ [];
    const ids = /*[[${ids}]]*/ [];
    const usedDates = /*[[${usedDates}]]*/ [];
    const numOfDatesNonZero = /*[[${numOfDatesNonZero}]]*/ [];

    const numOFLinksMax = Math.max.apply(Math,numOfDates);
    var container = document.getElementById("container");
    for (i=0;i<numOFLinksMax;i++){
        newlink = document.createElement('a');
        newlink.setAttribute('href','/');
        newlink.name = "link" + i;
        newlink.innerHTML = 'link' + i;
        newlink.setAttribute('class','hidden');
        container.appendChild(newlink);
        container.appendChild(document.createElement("br"));
    }
    
    const data = {
        labels: datesToInclude,
        datasets: [{
            label: 'Number of Artworks per year',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: numOfDates,
            barThickness: 2,
        }]
    };

    const config = {
        type: 'bar',
        data: data,
        options: {
            onClick: (event, activeElements) => {
                console.log("getElementsAtEventForMode: %o",myChart.getElementsAtEventForMode(event, "nearest", {intersect: false}));
                var whereAt = myChart.getElementsAtEventForMode(event, "point", {intersect: false});
                try {
                    console.log(whereAt[0].index);
                console.log("===== </CLICK EVENT> =====");
                document.getElementById("Title").innerHTML = ListOfTitles[datesOfItems.indexOf(whereAt[0].index+datesToInclude[0])]
                var indexOfIdList = 0;
                for (var i=0;i<usedDates.length;i++){
                    if (usedDates[i]=whereAt[0].index+datesToInclude[0]){
                        indexOfIdList = i;
                    }
                }
                var totalRecordBefore = 0; //how many records in total before the frist one in this clump
                var sizeOfNextClump = 0; //how many records are there in the next group
                for (var i =0;i<indexOfIdList;i++){
                    totalRecordBefore = totalRecordBefore + numOfDatesNonZero[i]
                    sizeOfNextClump = numOfDatesNonZero[i+1]
                }
                var children = container.children;
                for (var i =0;i<children.length;i++){
                    var linkChild = children[i];
                    linkChild.setAttribute('href','/');
                    linkChild.setAttribute('class','hidden');
                }
                for (var i=0;i<sizeOfNextClump-1;i++){
                    var linkChild = children[i];
                    linkChild.setAttribute('class','shown');
                    linkChild.setAttribute('href','/item/open-data-gallery-3-european-old-masters/'+ ids[i+totalRecordBefore]);
                }
                container.get
                } catch (error) {
                    
                }
            }
        }
    };
</script>


<script>
    const myChart = new Chart(
        document.getElementById('myChart'),
        config
    );
</script>